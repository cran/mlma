<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Qingzhao Yu and Bin Li" />

<meta name="date" content="2020-12-10" />

<title>Examples for Multilevel Mediation Analysis</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Examples for Multilevel Mediation Analysis</h1>
<h4 class="author">Qingzhao Yu and Bin Li</h4>
<h4 class="date">2020-12-10</h4>



<div id="package-installation" class="section level2">
<h2>Package installation</h2>
<p>The R package mlma is created for linear and nonlinear mediation analysis with multilevel data using multilevel additive models <span class="citation">(Yu and Li <a href="#ref-Yu2020a">2020</a>)</span>. The vignette is composed of three parts. We first generate a simulated dataset. Based on the simulation, part I focuses on how to transform variables and prepare data for the mediation analysis. Part II walks through functions of the multilevel mediation analysis and Part III explains how to make inferences on multilevel mediation effects.</p>
<p>To use the R package mlma, we first install the package in R (<code>install.packages(&quot;mlma&quot;)</code>) and load it.</p>
</div>
<div id="a-simulated-dataset" class="section level2">
<h2>A simulated dataset</h2>
<p>We generate a dataset with two levels. In the simulation, there are 1 level one exposure that is binary and 1 level two exposure that is continuous. There are also two mediators, one at each level. The level one mediator is continuous while the level two mediator is binary. The variables are generated by the following code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
n=<span class="dv">20</span>       <span class="co"># the number of observations in each group</span>
J&lt;-<span class="dv">600</span><span class="op">/</span>n   <span class="co"># there are 30 groups</span>
level=<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>J,<span class="dt">each=</span>n)
alpha_<span class="dv">211</span>&lt;-<span class="fl">0.8</span>     <span class="co">#covariates coefficients</span>
alpha_<span class="dv">1111</span>&lt;-<span class="fl">0.8</span>
alpha_<span class="dv">2111</span>&lt;-<span class="fl">0.8</span>
beta_<span class="dv">1</span>&lt;-<span class="fl">0.4</span>
beta_<span class="dv">2</span>&lt;-<span class="fl">0.4</span>
beta_<span class="dv">3</span>&lt;-<span class="fl">0.4</span>
beta_<span class="dv">4</span>&lt;-<span class="fl">0.4</span>
beta_<span class="dv">5</span>&lt;-<span class="fl">0.4</span>
v1=<span class="dv">5</span>              <span class="co">#the level 1 variance</span>
v2=v1<span class="op">/</span><span class="dv">5</span>           <span class="co">#the level 2 variance</span>

<span class="co">#The exposure variables</span>
x1&lt;-<span class="kw">rbinom</span>(<span class="dv">600</span>,<span class="dv">1</span>,<span class="fl">0.5</span>) <span class="co">#binary level 1 exposure, xij</span>
x2&lt;-<span class="kw">rep</span>(<span class="kw">rnorm</span>(J),<span class="dt">each=</span>n) <span class="co">#continuous level 2 exposure</span>

<span class="co">#The mediators</span>
m2&lt;-<span class="kw">rep</span>(<span class="kw">rbinom</span>(J,<span class="dv">1</span>,<span class="kw">exp</span>(alpha_<span class="dv">211</span><span class="op">*</span><span class="kw">unique</span>(x2<span class="op">^</span><span class="dv">2</span>))<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(alpha_<span class="dv">211</span><span class="op">*</span><span class="kw">unique</span>(x2<span class="op">^</span><span class="dv">2</span>)))),<span class="dt">each=</span>n)    <span class="co">#level 2 binary mediator</span>
u1&lt;-<span class="kw">rep</span>(<span class="kw">rnorm</span>(J,<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="dt">each=</span>n) <span class="co">#level 2 variance for mij</span>
e1&lt;-<span class="kw">rnorm</span>(n<span class="op">*</span>J)  <span class="co">#level 1 variance for mij</span>
m1&lt;-u1<span class="op">+</span>alpha_<span class="dv">1111</span><span class="op">*</span>x1<span class="op">+</span>alpha_<span class="dv">2111</span><span class="op">*</span>x2<span class="op">+</span>e1 <span class="co">#level 1 continuous mediator</span>

<span class="co">#The response variable</span>
u0&lt;-<span class="kw">rep</span>(<span class="kw">rnorm</span>(J,<span class="dv">0</span>,v2),<span class="dt">each=</span>n)
e0&lt;-<span class="kw">rnorm</span>(n<span class="op">*</span>J,<span class="dv">0</span>,v1)
y&lt;-u0<span class="op">+</span>beta_<span class="dv">1</span><span class="op">*</span>x1<span class="op">+</span>beta_<span class="dv">2</span><span class="op">*</span>x2<span class="op">+</span>beta_<span class="dv">3</span><span class="op">*</span><span class="kw">ifelse</span>(x2<span class="op">&lt;=</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="kw">log</span>(<span class="dv">1</span><span class="op">+</span>x2))<span class="op">+</span>beta_<span class="dv">4</span><span class="op">*</span>m1<span class="op">+</span>beta_<span class="dv">5</span><span class="op">*</span>m2<span class="op">+</span>e0</code></pre></div>
</div>
<div id="data-transformation-and-organization" class="section level2">
<h2>Data Transformation and Organization</h2>
<p>The <span class="math inline">\(data.org\)</span> function is used to do the transformation before the mediation analysis. In the function, the exposure variable(s) (<span class="math inline">\(x\)</span>) and the mediator(s) (<span class="math inline">\(m\)</span>) are required to input. The response variable (<span class="math inline">\(y\)</span>) is required only when its level (<span class="math inline">\(levely\)</span>) is not given. The argument <span class="math inline">\(levelx\)</span> is to identify the levels of the exposure variable. <span class="math inline">\(levelx\)</span> does not need to be provided. The function can automatically decide the level of the exposure variable(s). If any of the exposure variable is binary or categorical, <span class="math inline">\(xref\)</span> is used to identify the reference group of the exposure variable.</p>
<p>Note that the name for one mediator in <span class="math inline">\(m\)</span> should <strong>not</strong> be the subset of the name of another mediator.</p>
<p>The arguments <span class="math inline">\(l1\)</span> and <span class="math inline">\(l2\)</span> specify the column numbers in <span class="math inline">\(m\)</span> the continuous mediators at level one or level two respectively. <span class="math inline">\(c1\)</span> and <span class="math inline">\(c2\)</span> refers to the categorical mediators where <span class="math inline">\(c1r\)</span> and <span class="math inline">\(c2r\)</span> specify the reference group respectively. <span class="math inline">\(l1, l2, c1\)</span>, and <span class="math inline">\(c2\)</span> does not have to be provided. If not provided, the function <span class="math inline">\(data.org\)</span> checks each column of <span class="math inline">\(m\)</span> and decide whether each variable belongs to level 1 or 2, and be continuous or categorical.</p>
<p><span class="math inline">\(level\)</span> is a vector that record the group number for each observation. <span class="math inline">\(weight\)</span> defines the weight of each observation.</p>
<p><span class="math inline">\(f01y\)</span> and <span class="math inline">\(f10y\)</span> specify the desired transformation of exposures at level two or level one respectively in explaining the response variable. <span class="math inline">\(f01y\)</span> and <span class="math inline">\(f10y\)</span> are lists with the first item identify the column number of the exposure variable in <span class="math inline">\(x\)</span> that needs to be transformed, and then in that order, each of the rest items list the transformation functional expressions for each exposure. For example, <code>f10y=list(1,c(&quot;x^2&quot;,&quot;log(x)&quot;))</code> means that column 1 of <span class="math inline">\(x\)</span> is a level 1 exposure. It needs to be transformed to its square form and natural log form to predict the response variable. If not specified in <span class="math inline">\(f01y\)</span> or <span class="math inline">\(f10y\)</span>, the exposure will keep its original format without transformation. In our simulation data, the level two exposure is transformed to itself, <span class="math inline">\(x_{.j}\)</span> and <span class="math inline">\(I(x_{.j}&gt;0)\times log(x_{.j}+1)\)</span>. Therefore, we define <code>f01y=list(2,c(&quot;x&quot;,&quot;ifelse(x&gt;0,log(x+1),0)&quot;))</code>. Similarly, <span class="math inline">\(f02ky\)</span> and <span class="math inline">\(f20ky\)</span> defines the transformation of level two and level one mediators respectively in explaining <span class="math inline">\(y\)</span>.</p>
<p><span class="math inline">\(f01km1\)</span> and <span class="math inline">\(f01km2\)</span> are arguments that define transformation of level two exposures in explaining level one or level two mediator(s) respectively. Since only higher or equivalent level variables can be used as predictors, level one exposures can only be predictors for level one mediators. <span class="math inline">\(f10km\)</span> defines the transformation of level one exposure(s) in explaining level one mediator(s). In addition, when there are level two mediators but not level two exposure variable, the level one exposure variable(s) will be aggregated at level two to form the level two exposure variable(s). The first item of the the <span class="math inline">\(f01km1\)</span>, <span class="math inline">\(f01km2\)</span> and <span class="math inline">\(f10km\)</span> is a matrix of two columns, where the first column indicates the column number of the mediator in <span class="math inline">\(m\)</span>. The second column indicates the column number of the exposure in <span class="math inline">\(x\)</span>. By the order of the rows of the first item, each of the rest items of <span class="math inline">\(f01km1, f01km2\)</span> and <span class="math inline">\(f10km\)</span> list the transformation functional expressions for the exposure (identified by column 2) in explaining each mediator (identified by column 1). In our example, level two mediator <span class="math inline">\(m2\)</span> is explained by the level two exposure <span class="math inline">\(x2\)</span> in the form of <span class="math inline">\(x2^2\)</span>. Therefore, we set the argument <code>f01km2=list(matrix(c(2,2),1,2),&quot;x^2&quot;)</code>.</p>
<p>The following codes prepare for the data and perform the transformations. Note that the transformation functions can be set in different ways. Besides those in the example, we can also use the natural spline bases (e.g. <code>ns(x,df=5)</code>) and piecewise functions (e.g. <code>ifelse(x&gt;0,0,sqrt(x))</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">example1&lt;-<span class="kw">data.org</span>(<span class="dt">x=</span><span class="kw">cbind</span>(<span class="dt">x1=</span>x1,<span class="dt">x2=</span>x2), <span class="dt">m=</span><span class="kw">cbind</span>(<span class="dt">m1=</span>m1,<span class="dt">m2=</span>m2), 
                   <span class="dt">f01y=</span><span class="kw">list</span>(<span class="dv">2</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;ifelse(x&gt;0,log(x+1),0)&quot;</span>)),
                   <span class="dt">level=</span>level,
                   <span class="dt">f01km2=</span><span class="kw">list</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),<span class="dv">1</span>,<span class="dv">2</span>),<span class="st">&quot;x^2&quot;</span>)) </code></pre></div>
</div>
<div id="the-function-mlma-for-multilevel-mediation-analysis" class="section level2">
<h2>The function <span class="math inline">\(mlma\)</span> for multilevel mediation analysis</h2>
<p>The function <span class="math inline">\(mlma\)</span> can be executed based on the results from <span class="math inline">\(data.org\)</span> or on the original arguments of <span class="math inline">\(data.org\)</span>. In addition, the response variable needs to be set up by <span class="math inline">\(y\)</span>. If the response variable is categorical, <span class="math inline">\(yref\)</span> is used to specify the reference group. The <span class="math inline">\(random\)</span> argument is to set up the random effect part for the response variable and <span class="math inline">\(random.m1\)</span> is for the mediators.</p>
<p>The argument <span class="math inline">\(covariates\)</span> includes the data frame of all covariates for the response variable and/or mediators. For the response variable, covariates are defined as those variables used to explain <span class="math inline">\(y\)</span>, but are not related or caused by the exposure variable(s). Arguments <span class="math inline">\(cy1\)</span> and <span class="math inline">\(cy2\)</span> specify the column numbers of level one and two covariates respectively in <span class="math inline">\(covariates\)</span>. <span class="math inline">\(cm\)</span> specifies the covariates for mediators.</p>
<p>If the joint effect of a group of mediators are of interest, the group can be set up with the <span class="math inline">\(joint\)</span> argument. Finally, if users are interested in the medation effects on a new set of exposure and mediators. The new sets can also be set. Please read the menu of the package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mlma.e1&lt;-<span class="kw">mlma</span>(<span class="dt">y=</span>y,<span class="dt">data1=</span>example1,<span class="dt">intercept=</span>F)
mlma.e1
<span class="co">#&gt; Level 2 Third Variable Effects: </span>
<span class="co">#&gt;      TE   DE m2.1   m1</span>
<span class="co">#&gt; x2 1.05 0.62 0.01 0.43</span>
<span class="co">#&gt; Level 1 Third Variable Effects: </span>
<span class="co">#&gt;      TE  DE   m1</span>
<span class="co">#&gt; x1 1.04 0.5 0.54</span></code></pre></div>
<p>The result of mediation effect analysis shows the mediation effect from different levels. The direct effect, indirect effects and total effect are shown for each exposure-response pair of variables. For the above example, the level 1 total effect from <span class="math inline">\(x1\)</span> to <span class="math inline">\(y\)</span> is <span class="math inline">\(1.04\)</span>, of which direct effect is <span class="math inline">\(0.5\)</span>, indirect effect from <span class="math inline">\(m1\)</span> is <span class="math inline">\(0.54\)</span>. The level 2 total effect between <span class="math inline">\(x2\)</span> and <span class="math inline">\(y\)</span> is <span class="math inline">\(1.05\)</span>, in which the direct effect is <span class="math inline">\(0.62\)</span>, the indirect effect from <span class="math inline">\(m2\)</span> is <span class="math inline">\(0.01\)</span>, and from <span class="math inline">\(m1\)</span> is <span class="math inline">\(0.43\)</span>.</p>
<div id="the-summary-function-for-multilevel-mediaiton-analysis" class="section level3">
<h3>The <span class="math inline">\(summary\)</span> function for multilevel mediaiton analysis</h3>
<p>The <span class="math inline">\(summary\)</span> function provides the ANOVA tests of the exposure variables and mediators in the full model to estimate the response variable. It also provides the ANOVA tests of the exposure variable(s) in predicting each mediator. Using the results, users can decide which variables should be included as mediators and which ones should be used as covariates and rerun the multilevel mediation analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mlma.e1)
<span class="co">#&gt; 1. Anova on the Full Model:</span>
<span class="co">#&gt; Analysis of Deviance Table (Type III Wald chisquare tests)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Response: y</span>
<span class="co">#&gt;       Chisq Df Pr(&gt;Chisq)   </span>
<span class="co">#&gt; x1   1.3500  1   0.245285   </span>
<span class="co">#&gt; x2.1 0.3080  1   0.578897   </span>
<span class="co">#&gt; x2.2 0.0998  1   0.752076   </span>
<span class="co">#&gt; m2.2 0.0403  1   0.840988   </span>
<span class="co">#&gt; m1   7.5740  1   0.005922 **</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 2. Anova on models for Level 1 mediators:</span>
<span class="co">#&gt; $m1</span>
<span class="co">#&gt; Analysis of Deviance Table (Type III Wald chisquare tests)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Response: y</span>
<span class="co">#&gt;      Chisq Df Pr(&gt;Chisq)    </span>
<span class="co">#&gt; x2  51.817  1  6.092e-13 ***</span>
<span class="co">#&gt; x1 111.038  1  &lt; 2.2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 3. Anova on models for Level 2 mediators:</span>
<span class="co">#&gt; $m2</span>
<span class="co">#&gt; Analysis of Deviance Table (Type III tests)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Response: y</span>
<span class="co">#&gt;        LR Chisq Df Pr(&gt;Chisq)   </span>
<span class="co">#&gt; x2.2.1   9.5608  1   0.001988 **</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>To check the actual coefficients for each variable in the full model or in the model to predict level one or level two mediators, we can check the results from <span class="math inline">\(mlma\)</span> directly.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mlma.e1<span class="op">$</span>f1   <span class="co">#the full model</span>
<span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span>
<span class="co">#&gt; Formula: y ~ x1 + x2.1 + x2.2 + m2.2 + m1 - 1 + (1 | level)</span>
<span class="co">#&gt;    Data: data.frame(temp.data)</span>
<span class="co">#&gt; REML criterion at convergence: 3660.149</span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;  Groups   Name        Std.Dev.</span>
<span class="co">#&gt;  level    (Intercept) 1.182   </span>
<span class="co">#&gt;  Residual             5.040   </span>
<span class="co">#&gt; Number of obs: 600, groups:  level, 30</span>
<span class="co">#&gt; Fixed Effects:</span>
<span class="co">#&gt;     x1    x2.1    x2.2    m2.2      m1  </span>
<span class="co">#&gt; 0.5021  0.4120  0.5781  0.1328  0.4979</span>
mlma.e1<span class="op">$</span>fm1  <span class="co">#models for level 1 mediators</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span>
<span class="co">#&gt; Formula: y ~ x2 + x1 - 1 + (1 | level)</span>
<span class="co">#&gt;    Data: data.frame(temp.data)</span>
<span class="co">#&gt; REML criterion at convergence: 1863.169</span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;  Groups   Name        Std.Dev.</span>
<span class="co">#&gt;  level    (Intercept) 0.5675  </span>
<span class="co">#&gt;  Residual             1.0878  </span>
<span class="co">#&gt; Number of obs: 600, groups:  level, 30</span>
<span class="co">#&gt; Fixed Effects:</span>
<span class="co">#&gt;     x2      x1  </span>
<span class="co">#&gt; 0.8537  0.8955</span>
mlma.e1<span class="op">$</span>fm2  <span class="co">#models for level 2 mediators</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glm(formula = frml.m, family = binomial(link = &quot;logit&quot;), data = data.frame(temp.data))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; x2.2.1  </span>
<span class="co">#&gt;  1.277  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Degrees of Freedom: 30 Total (i.e. Null);  29 Residual</span>
<span class="co">#&gt; Null Deviance:       41.59 </span>
<span class="co">#&gt; Residual Deviance: 32.03     AIC: 34.03</span></code></pre></div>
</div>
<div id="the-plot-function-for-the-mlma-object" class="section level3">
<h3>The plot function for the mlma object</h3>
<p>The <span class="math inline">\(plot\)</span> function help depict the directions of mediaiton effects. Without specifying the mediator (by <span class="math inline">\(var\)</span>), the <span class="math inline">\(plot\)</span> function plots the overall medation effects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(mlma.e1)
<span class="co">#&gt; Error in plot.new(): figure margins too large</span></code></pre></div>
<p>By specifying the mediator, the <span class="math inline">\(plot\)</span> function shows the indirect effect of the mediator, and its marginal relationship with the response variable and with the exposure variable at each level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(mlma.e1,<span class="dt">var=</span><span class="st">&quot;m1&quot;</span>)
<span class="co">#&gt; Error in plot.new(): figure margins too large</span>
<span class="kw">plot</span>(mlma.e1,<span class="dt">var=</span><span class="st">&quot;m2&quot;</span>)
<span class="co">#&gt; Error in plot.new(): figure margins too large</span></code></pre></div>
</div>
</div>
<div id="make-inferences-on-multilevel-mediation-effect" class="section level2">
<h2>Make Inferences on Multilevel Mediation effect</h2>
<p>Finally, the <span class="math inline">\(boot.mlma\)</span> function uses the bootstrap method to estimate mediation effects and the estimated variances and confidence intervals. Again, the analysis can be built on the results from <span class="math inline">\(data.org\)</span>. The default number of bootstrap samples is <span class="math inline">\(100\)</span>, which can be changed to other desired numbers. The <span class="math inline">\(summary\)</span> function for the output of <span class="math inline">\(boot.mlma\)</span> gives the inference results for all mediation effects. Two confidence intervals are built up for the estimated mediation effects. (lwbd, upbd) is based on the normal approximation and (lwbd_quan, upbd.quan) is built by the quantiles of the bootstrap results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boot.e1&lt;-<span class="kw">boot.mlma</span>(<span class="dt">y=</span>y,<span class="dt">data1=</span>example1,<span class="dt">echo=</span>F,<span class="dt">intercept =</span> F)
<span class="kw">summary</span>(boot.e1)
<span class="co">#&gt; MLMA Analysis: Estimated Effects at level 1:</span>
<span class="co">#&gt; $x1</span>
<span class="co">#&gt;               te     de      m1</span>
<span class="co">#&gt; est       1.0447 0.5021  0.5426</span>
<span class="co">#&gt; mean      0.5395 0.5562 -0.0167</span>
<span class="co">#&gt; sd        0.0000 0.0000  0.0000</span>
<span class="co">#&gt; upbd      0.5395 0.5562 -0.0167</span>
<span class="co">#&gt; lwbd      0.5395 0.5562 -0.0167</span>
<span class="co">#&gt; upbd.quan 0.5395 0.5562 -0.0167</span>
<span class="co">#&gt; lwbd.quan 0.5395 0.5562 -0.0167</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MLMA Analysis: Estimated Effects at level 2:</span>
<span class="co">#&gt; $x2</span>
<span class="co">#&gt;               te     de   m2.1     m1</span>
<span class="co">#&gt; est       1.0496 0.6183 0.0063 0.4250</span>
<span class="co">#&gt; mean      1.0518 0.6495 0.0045 0.3979</span>
<span class="co">#&gt; sd        0.0000 0.0000 0.0000 0.0000</span>
<span class="co">#&gt; upbd      1.0518 0.6495 0.0045 0.3979</span>
<span class="co">#&gt; lwbd      1.0518 0.6495 0.0045 0.3979</span>
<span class="co">#&gt; upbd.quan 1.0518 0.6495 0.0045 0.3979</span>
<span class="co">#&gt; lwbd.quan 1.0518 0.6495 0.0045 0.3979</span></code></pre></div>
<p>The <span class="math inline">\(plot\)</span> function for the <span class="math inline">\(boot.mlma\)</span> objects works similarly for the <span class="math inline">\(mlma\)</span> objects but confidence intervals for estimations are added.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(boot.e1)
<span class="co">#&gt; Error in plot.new(): figure margins too large</span>
<span class="kw">plot</span>(boot.e1,<span class="dt">var=</span><span class="st">&quot;m1&quot;</span>)
<span class="co">#&gt; Error in plot.new(): figure margins too large</span>
<span class="kw">plot</span>(boot.e1,<span class="dt">var=</span><span class="st">&quot;m2&quot;</span>)
<span class="co">#&gt; Error in plot.new(): figure margins too large</span></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-Yu2020a">
<p>Yu, Qingzhao, and Bin Li. 2020. “Third-Variable Effect Analysis with Multilevel Additive Models.” <em>Submitted Manuscript</em>.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
